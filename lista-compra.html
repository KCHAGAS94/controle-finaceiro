<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Controle de Compra Supermercado</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f4f4f4;
      color: #333;
    }

    h1 {
      text-align: center;
      color: #2c3e50;
    }

    form {
      max-width: 600px;
      margin: 20px auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }

    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }

    input[type="text"], input[type="number"], input[type="checkbox"] {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
      box-sizing: border-box;
    }

    button {
      margin-top: 20px;
      padding: 10px 15px;
      font-size: 16px;
      background-color: #27ae60;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    button:hover {
      background-color: #219150;
    }

    table {
      max-width: 600px;
      margin: 20px auto;
      border-collapse: collapse;
      width: 100%;
      background: white;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      border-radius: 8px;
      overflow: hidden;
    }

    th, td {
      padding: 10px;
      border-bottom: 1px solid #ddd;
      text-align: left;
    }

    th {
      background-color: #27ae60;
      color: white;
    }

    .delete-btn {
      margin-top: 10px;
      background-color: #e74c3c;
      color: white;
      padding: 6px 12px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .delete-btn:hover {
      background-color: #c0392b;
    }
  </style>
</head>
<body>

<h1>Cadastrando compras</h1>

<div id="mainApp">
  <!-- Formulário para adicionar produtos -->
  <form id="productForm">
    <label for="productName">Nome do produto:</label>
    <input type="text" id="productName" required />

    <label for="quantity">Quantidade:</label>
    <input type="number" id="quantity" min="1" value="1" required />

    <button type="submit">Adicionar Produto</button>
  </form>

  <table id="productsTable">
    <thead>
      <tr>
        <th>Produto</th>
        <th>Quantidade</th>
        <th>Unitário</th>
        <th>Total</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script src="firebase.lista-compra.js"></script>

<script>
  const form = document.getElementById("productForm");
  const tableBody = document.querySelector("#productsTable tbody");
  let produtos = [];

  // Função para formatar valores em moeda
  function formatarMoeda(valor) {
    return valor.toLocaleString("pt-BR", {
      style: "currency",
      currency: "BRL"
    });
  }

  // Função para adicionar um produto na tabela
  function adicionarNaTabela(produto, index) {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${produto.nome}</td>
      <td>${produto.quantidade}</td>
      <td><input type="number" class="unit-price" data-index="${index}" placeholder="R$ 0,00" /></td>
      <td>${formatarMoeda(produto.total)}</td>
      <td><input type="checkbox" class="status" data-index="${index}" ${produto.pego ? "checked" : ""} /></td>
    `;
    tableBody.appendChild(tr);

    // Adicionar evento para alterar o valor unitário e atualizar o total
    tr.querySelector(".unit-price").addEventListener("input", (e) => {
      const unitPrice = parseFloat(e.target.value.replace(",", "."));
      if (!isNaN(unitPrice)) {
        produto.unitario = unitPrice;
        produto.total = produto.unitario * produto.quantidade;
        tr.querySelector("td:nth-child(4)").textContent = formatarMoeda(produto.total);
      }
    });

    // Adicionar evento para marcar o produto como pego
    tr.querySelector(".status").addEventListener("change", (e) => {
      produto.pego = e.target.checked;
    });
  }

  // Função para atualizar a tabela
  function atualizarTabela() {
    tableBody.innerHTML = "";
    produtos.forEach((produto, index) => adicionarNaTabela(produto, index));
  }

  // Função para adicionar produto à lista e ao Firebase
  function adicionarProduto(nome, quantidade) {
    const produto = {
      nome,
      quantidade,
      unitario: 0,
      total: 0,
      pego: false
    };
    produtos.push(produto);

    // Adicionar produto ao Firestore
    db.collection("compras").add(produto)
      .then(() => {
        console.log("Produto adicionado ao Firestore");
        atualizarTabela();
      })
      .catch((error) => {
        console.error("Erro ao adicionar produto ao Firestore: ", error);
      });
  }

  // Adicionar produto ao submeter o formulário
  form.addEventListener("submit", (e) => {
    e.preventDefault();

    const nome = document.getElementById("productName").value.trim();
    const quantidade = parseInt(document.getElementById("quantity").value);

    if (nome && quantidade > 0) {
      adicionarProduto(nome, quantidade);
    }

    form.reset();
  });
</script>

</body>
</html>
